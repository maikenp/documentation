

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Tuning applications &mdash; Sigma2 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/sigma2.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Software Module Scheme" href="../software/modulescheme.html" />
    <link rel="prev" title="Guides" href="../code_development/guides.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Sigma2/Metacenter documentation
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">News</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://opslog.sigma2.no">Latest changes and events</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.sigma2.no/hardware-status">Hardware live status</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/support_line.html">Support line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/how_to_write_good_support_requests.html">Writing good support requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/qa-sessions.html">Open Question &amp; Answer Sessions for All Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/lost_forgotten_password.html">Lost or expiring password</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/project_leader_support.html">Project leader support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/advanced_user_support.html">Advanced User Support (AUS)</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/applying_account.html">How do I get an HPC account?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/applying_resources.html">Applying for computing and storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/training.html">Training material</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/editing_files.html">Editing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/create_ssh_keys.html">SSH</a></li>
</ul>
<p class="caption"><span class="caption-text">Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../nird_archive/user-guide.html">Research data archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nird_toolkit/overview.html">NIRD Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/easydmp-user-documentation.html">EasyDMP User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/course_resources.html">CRaaS - Course Resources as a Service</a></li>
</ul>
<p class="caption"><span class="caption-text">High-performance computing</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/hardware_overview.html">Overview over our machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/betzy.html">Betzy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/fram.html">Fram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/saga.html">Saga</a></li>
<li class="toctree-l1"><a class="reference external" href="https://hpc-uit.readthedocs.io">Stallo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/migration2metacenter.html">Migration to a Metacenter HPC machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jobs/overview.html">Job types and job scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_development/overview.html">Code development</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tuning applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scaling">Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#arm-performance-reports">ARM Performance reports</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running">Running</a></li>
<li class="toctree-l3"><a class="reference internal" href="#header">Header</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#details-cpu">Details - CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#details-mpi">Details - MPI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#intel-advisor">Intel Advisor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-and-collecting">Running and collecting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#display-survey">Display Survey</a></li>
<li class="toctree-l3"><a class="reference internal" href="#display-roof-line-model">Display Roof-line model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#display-memory-access">Display Memory access</a></li>
<li class="toctree-l3"><a class="reference internal" href="#display-memory-dependencies">Display memory dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#program-efficiency">Program efficiency</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software/modulescheme.html">Software Module Scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/installed_software.html">Installed Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/userinstallsw.html">Installing software as user</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/containers.html">Running Singularity and Docker containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/appguides.html">Application guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/licenses.html">Licenses and access policies</a></li>
</ul>
<p class="caption"><span class="caption-text">Files and Storage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/nird.html">NIRD - National Infrastructure for Research Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/clusters.html">Storage areas on HPC clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/backup.html">Backup on Betzy, Fram, Saga, and NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/sharing_files.html">Data handling and storage policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/file_transfer.html">File transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/performance.html">Storage performance tuning</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sigma2/Metacenter documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Tuning applications</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/UNINETTSigma2/documentation/blob/master/computing/tuning-applications.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tuning-applications">
<h1>Tuning applications<a class="headerlink" href="#tuning-applications" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Running scientific application in order to maximise the efficiency of
the hardware is increasingly important as the core count increase. A
system like Betzy with 172k cores represent a substantial cost and
efficiency of the applications run should be as high a practically
possible.</p>
<p>There are several steps with increasing complexity that can be taken
to learn more about the application’s behaviour. Starting from
checking the scaling to produce a roof line model of the application.
Digging deeper into the matter is also possible with even more
advanced usage of the tools and even more advanced tools.</p>
<p>A set of tools is presented, each with increasing complexity.</p>
<p>In this case study we’ll follow a real application called FVCOM which
is an ocean current simulation code. I typically run on 1024 cores,
not the application with the highest core count, but a typical example
of a seasoned well known application with it’s special traits.</p>
</div>
<div class="section" id="scaling">
<h2>Scaling<a class="headerlink" href="#scaling" title="Permalink to this headline">¶</a></h2>
<p>The scaling of an application is one of the key factors for running in
parallel. This simple metric is very simple to record. Just run the
application with an increasing number of cores and record the run time
(many ways exist to record run time, but <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">-p</span> <span class="pre">mpirun</span> <span class="pre">&lt;executable&gt;</span></code>
is one of the simplest. As the speedup in many cases also depend on
the input data used it is important to run the scaling test with a
relevant input data set.</p>
<p>Plot the recorded run time as function of core used and look for trend in the run time,
alternatively plot the speedup from the lowest core count.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p># cores</p></th>
<th class="head"><p>run time</p></th>
<th class="head"><p>speedup</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>128</p></td>
<td><p>4071.89</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>256</p></td>
<td><p>2193.52</p></td>
<td><p>1.86</p></td>
</tr>
<tr class="row-even"><td><p>512</p></td>
<td><p>1173.19</p></td>
<td><p>3.47</p></td>
</tr>
<tr class="row-odd"><td><p>1024</p></td>
<td><p>659.38</p></td>
<td><p>6.18</p></td>
</tr>
<tr class="row-even"><td><p>2048</p></td>
<td><p>395.53</p></td>
<td><p>10.29</p></td>
</tr>
</tbody>
</table>
<div class="figure align-default" id="id2">
<img alt="Scaling" src="../_images/Speedup.png" />
<p class="caption"><span class="caption-text">Fig. 1 - Scaling</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The plot show the recorded speedup for FVCOM with the current input data.
The dashed line represent perfect speedup.</p>
</div>
<div class="section" id="arm-performance-reports">
<h2>ARM Performance reports<a class="headerlink" href="#arm-performance-reports" title="Permalink to this headline">¶</a></h2>
<p>To learn a great deal of the application the tool
<code class="docutils literal notranslate"><span class="pre">Performance-reports</span></code> can be used.  This tool profile the application
and provide a one page report with a huge array of important metrics.</p>
<div class="section" id="running">
<h3>Running<a class="headerlink" href="#running" title="Permalink to this headline">¶</a></h3>
<p>The commands used to run the ARM performance reports are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>module load Arm-PerfReports/20.0.3
perf-report mpirun ./fvcom.bin --casename=$RUN &gt; $RUN_DIR/log-${SLURM_JOBID}.out
</pre></div>
</div>
<p>When the SLURM job is finished two files containing performance reports are found as:
<code class="docutils literal notranslate"><span class="pre">fvcom_1024p_8n_1t_yyyy-mm-dd_hh-mm.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">fvcom_1024p_8n_1t_yyyy-mm-dd_hh-mm.html</span></code>.</p>
</div>
<div class="section" id="header">
<h3>Header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id3">
<img alt="Performance report header" src="../_images/Perf-reports-1.png" />
<p class="caption"><span class="caption-text">Fig. 2 - Performance report header</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>The header give basic
information how the application was invoked and run. It also provide
total wall time. The figure to the right give a quick overview of how
the time is distributed over the categories of execution. This is
binned into 3 categories, compute time, time spent in MPI library and
time spent doing Input &amp; Output. In this example we see that time is
spent on doing computation and communication using MPI.</p>
</div>
<div class="section" id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id4">
<img alt="Performance report summary" src="../_images/Perf-reports-2.png" />
<p class="caption"><span class="caption-text">Fig. 3 - Performance report summary</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>The summary report
section contain a lot of useful information in just a few lines.  It
show us that only 69% of the time is spent doing computations. This
metric is important when we calculate the total efficiency of the
application.</p>
<p>The next entry teach us that the application spent 31% of the total
time doing communication using MPI. This is time spent as a
consequence of MPI functions needed to make a parallel program. This
number should be as low as possible as the time spend doing
communications is wasted compute cycles. About 1/3 of all compute
cycles in this run is wasted do to waiting for MPI functions t
complete.</p>
<p>The last entry show that FVCOM does very little Input &amp; Output during
a run. Other applications might have a far larger number here.</p>
</div>
<div class="section" id="details-cpu">
<h3>Details - CPU<a class="headerlink" href="#details-cpu" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id5">
<img alt="Performance report Details - CPU" src="../_images/Perf-reports-3.png" />
<p class="caption"><span class="caption-text">Fig. 4 - Performance report Details - CPU</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>The CPU details
give us some hints about the actual CPU usage and the application
instructions and memory access.  This is a pure MPI application and
each rank is single core, hence 100% single core.</p>
<p>36% of the compute time is spend executing scalar numeric operations,
only 0.3% is spend executing vector operations. This is not good, as
the AMD Rome processors have AVX2 vector instructions capable of 256
bits, 4 double or 8 single precision of floating point operations in
one instruction. Using only scalar instructions mean that we are only
exploiting 1/4 or 1/8th of the total compute capacity of the
processor.</p>
<p>62% of the compute time is spent waiting for data to be moved to and
from memory into the processor. This is normally due to a limitation
of the memory bandwidth as is normally the case or poor programming
with a lot of random memory accesses. Poor memory bandwidth is a
common performance limitation. While the AMD Rome processors in Betzy
show memory bandwidth in excess of 300 Gbytes per second this is far
from enough to keep up with a processor running at 2500 MHz. Example,
300 Gbytes/s is 37 G double precision floats per second. A single core
can do 4 double precision operations per vector unit per clock or 2.5
GHz*4 = 10 Gflops/s. Then there are two vector units per core and 128
cores in total. The cache helps in data can be reused in several
calculations, but as the measurements show the bulk of time is spent
waiting for memory.</p>
<p>The comments below clearly indicate this as the application is memory
bound and very little time is spent in vectorised code.</p>
</div>
<div class="section" id="details-mpi">
<h3>Details - MPI<a class="headerlink" href="#details-mpi" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id6">
<img alt="Performance report Details - MPI" src="../_images/Perf-reports-4.png" />
<p class="caption"><span class="caption-text">Fig. 5 - Performance report Details - MPI</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p>The MPI details
informs us that of the time spent in communication the majority of the
MPI (63%) time is spent on doing collective operations, while the rest
is spent in point-to-point communication. The relatively high fraction
of time in collectives can be due to imbalance between the ranks. We
see that the transfer rate is only in single digit Mbytes/s and only
two digits for point-to-point. Very far from the wire speed at about
10 Gbytes/s.</p>
<div class="figure align-default" id="id7">
<img alt="Performance report Details - IO" src="../_images/Perf-reports-5.png" />
<p class="caption"><span class="caption-text">Fig. 6 - Performance report Details - IO</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<p>The IO details
show that FVCOM spent a very little time doing IO during a run. About equal
time for read and write. The transfer bandwidth is low as the file system is
capable of far higher bandwidth.</p>
<div class="figure align-default" id="id8">
<img alt="Performance report Details - OpenMP" src="../_images/Perf-reports-6.png" />
<p class="caption"><span class="caption-text">Fig. 7 - Performance report Details - OpenMP</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<p>The OpenMP
(threads) detail report is of little use for FVCOM as it is a single
threaded put MPI application. The same division as for MPI is relevant
here computation and synchronisation. In OpenMP which used shared
memory there is no transfer of data as all is in the same memory, but
access control is very important. Hence synchronisation can make up a
fraction of the time. False sharing is thing to look out for here when
developing multi threaded programs. It’s easy to forget that while
processor address individual bytes the cache is 64 bytes chunks of
memory that might overlap with another thread in another core and
cache line.</p>
<div class="figure align-default" id="id9">
<img alt="Performance report Details - Memory" src="../_images/Perf-reports-7.png" />
<p class="caption"><span class="caption-text">Fig. 8 - Performance report Details - Memory</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
<p>The Memory detail report show the amount of memory used, mean and peak. As for
FVCOM with the input model in question it uses only 22% of the nodes’ memory.</p>
<p>It does unfortunately not give any information about strided or random
access. Even scalar operation can exhibit nice strided access. Any
form of random access can kill any performance. Accessing bytes at 100
nm access time (for normal DDR memory) effectively run the processing
speed at 10 MHz frequency.</p>
</div>
</div>
<div class="section" id="intel-advisor">
<h2>Intel Advisor<a class="headerlink" href="#intel-advisor" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Introduction<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>I order to get even more insight of your application with respect to
code generated (vector instructions, vectorised loops etc),
performance and memory access the tool Intel Advisor come in handy.</p>
<p>It’s very good for investigating how the compiler generated vector
code and also providing hints about vectorisation. It can also provide
information about memory access, like striding type.</p>
<p>It can record memory bandwidth and flops which is used to make a
<em>roof-line model</em>.  Please read about the
<a class="reference external" href="https://en.wikipedia.org/wiki/Roofline_model">roof-line model</a>.
if you are unfamiliar with it.</p>
<p>This case study does not go into depth on how to understand the
advisor tool, this is far better covered in the Intel tools
<a class="reference external" href="https://software.intel.com/content/www/us/en/develop/documentation.html">documentation</a>,
where they also provide a nice selection of tutorials.</p>
</div>
<div class="section" id="running-and-collecting">
<h3>Running and collecting<a class="headerlink" href="#running-and-collecting" title="Permalink to this headline">¶</a></h3>
<p>The GUI can be used to set up, launch, control and analyse the application. However,
it’s simpler to collect data within a batch job.
When running MPI jobs it’s only needed to run a single executable as they are all the same.
A project directory need to be created before command line collection can be initiated.</p>
<p>The commands that used to collect data for FVCOM in the batch job are when using OpenMPI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>module load Advisor/2019_update5

advdir=$(dirname $(which advixe-cl))
mpirun -np 1  $advdir/advixe-cl -project-dir /cluster/work/support/olews/FVCOM_build/MATNOC-iompi/PO3/fvcom3   --collect survey -- ./fvcom.bin --casename=$RUN : -np 1023  ./fvcom.bin --casename=$RUN  &gt; $RUN_DIR/log-${SLURM_JOBID}.out
</pre></div>
</div>
<p>An absolute path for mpirun arguments is needed, either full path or relative.
The project directory is also given with full path. This directory need to be present before
the collection begin.</p>
<p>When survey has been run <em>tripcounts</em> and <em>flops</em> can be collected.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>module load Advisor/2019_update5

advdir=$(dirname $(which advixe-cl))
mpirun -np 1  $advdir/advixe-cl -project-dir /cluster/work/support/olews/FVCOM_build/MATNOC-iompi/PO3/fvcom3   --collect tripcounts -flop -- ./fvcom.bin --casename=$RUN : -np 1023  ./fvcom.bin --casename=$RUN  &gt; $RUN_DIR/log-${SLURM_JOBID}.out
</pre></div>
</div>
<p>Memory access can be collected using the <em>map</em> keyword.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>module load Advisor/2019_update5

advdir=$(dirname $(which advixe-cl))
mpirun -np 1  $advdir/advixe-cl -project-dir /cluster/work/support/olews/FVCOM_build/MATNOC-iompi/PO3/fvcom3   --collect map -flop -- ./fvcom.bin --casename=$RUN : -np 1023  ./fvcom.bin --casename=$RUN  &gt; $RUN_DIR/log-${SLURM_JOBID}.out
</pre></div>
</div>
<p>Both <em>tripcounts</em> and <em>map</em> increase the run time significantly,
remember to increase the SLURM run time.</p>
</div>
<div class="section" id="display-survey">
<h3>Display Survey<a class="headerlink" href="#display-survey" title="Permalink to this headline">¶</a></h3>
<p>To display the collected data please start the Advisor GUI tool using (remember to
log in using ssh -Y, so the login nodes have connection to your X11 terminal):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">advixe</span><span class="o">-</span><span class="n">gui</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>Open the project file and report file on rank0 (we run the collection on rank0).</p>
<div class="figure align-default">
<img alt="../_images/Advisor-1.png" src="../_images/Advisor-1.png" />
</div>
<p>The fist screen show en overview of the run, elapsed time, time in vector and scalar code.
In addition Gflops/s for Floating point &amp; integer and some CPU cache data load.
The fact that only 37.5% of the CPU time is spent executing vector instructions tells
us that the compiler did not manage to vectorise the loops as often as we would hope for.</p>
</div>
<div class="section" id="display-roof-line-model">
<h3>Display Roof-line model<a class="headerlink" href="#display-roof-line-model" title="Permalink to this headline">¶</a></h3>
<p>By clicking at the vertical stripe marked “roofline” the obtained
roof-line model of the application is displayed. It shows us
graphically how the application map out on a memory bandwidth vs
performance scale, see link to <em>roof-line model</em> above.</p>
<div class="figure align-default">
<img alt="../_images/Advisor-2.png" src="../_images/Advisor-2.png" />
</div>
<p>The circles are all located at the memory bandwidth
line and left the regions where the application is compute bound. This
is another illustration that the application performance is limited by
the memory bandwidth. The two colours identifies scalar (blue) and
vector (orange) performance.</p>
<p>The Advisor can also generated some recommendations that can be helpful.</p>
<div class="figure align-default">
<img alt="../_images/Advisor-6.png" src="../_images/Advisor-6.png" />
</div>
</div>
<div class="section" id="display-memory-access">
<h3>Display Memory access<a class="headerlink" href="#display-memory-access" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default">
<img alt="../_images/Advisor-7.png" src="../_images/Advisor-7.png" />
</div>
<p>The map collection will record memory accesses and
lump them into categories for unit, constant and variable stride. It’s
well known that variable stride is very bad for performance. By providing
references to the source code it’s possible to review the code and see if it’s
possible to rewrite or do any changes that will improve performance.</p>
</div>
<div class="section" id="display-memory-dependencies">
<h3>Display memory dependencies<a class="headerlink" href="#display-memory-dependencies" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default">
<img alt="../_images/Advisor-8.png" src="../_images/Advisor-8.png" />
</div>
<p>The dependency collection (takes very long time 20-100x
normal run time) record variable that reuse same variables,
e.g. memory location and potential race condition and sharing. The
compiler need to take action and generate code that places locks and
semaphores on such variables. This can have significant impact on
performance.</p>
</div>
<div class="section" id="program-efficiency">
<h3>Program efficiency<a class="headerlink" href="#program-efficiency" title="Permalink to this headline">¶</a></h3>
<p>The Advisor can calculate a total performance of the complete run:</p>
<div class="figure align-default">
<img alt="../_images/Advisor-4.png" src="../_images/Advisor-4.png" />
</div>
<p>The number is discouraging, 0.46 Gflops/s. A single
core can perform the following with two vector units at 256 bits
each : 2.5 GHz * 256 bits (4 double,64 bits) * 2 (two vector units) =
20 Gflops/s or using Fuse multiply add to get twice the performance at
40 Gflops/s. For single precision 32 bits the numbers can be
multiplied by two.</p>
<p>Using the most conservative numbers for double precision and not fused
multiply add (20 Gflops/s) we get 0.46 / 20 = 2.3% of the theoretical
performance.</p>
<p>This performance is not unusual for scientific code of this type. We
saw early on that only a fraction of the time (68.6%) was spent in CPU
time, of that time only a fraction was spent computing (35.9 + 0.3 =
36.2%). Combining this we arrive at 0.686*0.36.2=0.248 or 25% of the
time was spent computing.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../software/modulescheme.html" class="btn btn-neutral float-right" title="Software Module Scheme" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../code_development/guides.html" class="btn btn-neutral float-left" title="Guides" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Sigma2/Metacenter.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>